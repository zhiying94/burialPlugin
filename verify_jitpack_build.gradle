// éªŒè¯ JitPack æ„å»ºçŠ¶æ€çš„è„šæœ¬
// ä½¿ç”¨æ–¹æ³•: ./gradlew -b verify_jitpack_build.gradle checkBuildStatus

plugins {
    id 'java'
}

repositories {
    maven { url "https://jitpack.io" }
    mavenCentral()
    mavenLocal()
}

configurations {
    testDeps
}

dependencies {
    // æµ‹è¯• burialTimer è¿œç¨‹ä¾èµ–
    testDeps 'com.github.zhiying94:burialTimer:2.0.15'
    
    // æµ‹è¯•æ’ä»¶ç±»è·¯å¾„
    testDeps 'com.github.zhiying94:burial-plugin:2.0.15'
}

task checkBuildStatus {
    doLast {
        println "å¼€å§‹æ£€æŸ¥ JitPack æ„å»ºçŠ¶æ€..."
        
        try {
            // æ£€æŸ¥ä¾èµ–æ˜¯å¦è§£ææˆåŠŸ
            configurations.testDeps.resolvedConfiguration.resolvedArtifacts.each { artifact ->
                println "âœ… æˆåŠŸè§£æä¾èµ–: ${artifact.moduleVersion.id.group}:${artifact.moduleVersion.id.name}:${artifact.moduleVersion.id.version}"
            }
            println "ğŸ‰ JitPack æ„å»ºæˆåŠŸï¼è¿œç¨‹ä¾èµ–å¯ç”¨ï¼"
        } catch (Exception e) {
            println "âŒ JitPack æ„å»ºå¤±è´¥æˆ–æœªå®Œæˆ: ${e.message}"
            println "è¯·ç­‰å¾… JitPack æ„å»ºå®Œæˆï¼Œæˆ–æ£€æŸ¥æ„å»ºæ—¥å¿—"
        }
    }
}

task testBurialTimer {
    doLast {
        println "æµ‹è¯• burialTimer ä¾èµ–..."
        try {
            def deps = configurations.testDeps.resolvedConfiguration.resolvedArtifacts
            def burialTimer = deps.find { it.name == 'burialTimer' }
            if (burialTimer) {
                println "âœ… burialTimer ä¾èµ–å¯ç”¨: ${burialTimer.moduleVersion.id.version}"
            } else {
                println "âŒ burialTimer ä¾èµ–ä¸å¯ç”¨"
            }
        } catch (Exception e) {
            println "âŒ æµ‹è¯•å¤±è´¥: ${e.message}"
        }
    }
}

task testPlugin {
    doLast {
        println "æµ‹è¯•æ’ä»¶ä¾èµ–..."
        try {
            def deps = configurations.testDeps.resolvedConfiguration.resolvedArtifacts
            def plugin = deps.find { it.name == 'burial-plugin' }
            if (plugin) {
                println "âœ… æ’ä»¶ä¾èµ–å¯ç”¨: ${plugin.moduleVersion.id.version}"
            } else {
                println "âŒ æ’ä»¶ä¾èµ–ä¸å¯ç”¨"
            }
        } catch (Exception e) {
            println "âŒ æµ‹è¯•å¤±è´¥: ${e.message}"
        }
    }
}
