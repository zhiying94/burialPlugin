// å‘å¸ƒè„šæœ¬ - ç”¨äºç®€åŒ–å‘å¸ƒæµç¨‹
// ä½¿ç”¨æ–¹æ³•: ./gradlew -b scripts/publish.gradle publishToMavenCentral

allprojects {
    apply plugin: 'maven-publish'
    apply plugin: 'signing'
    
    // é…ç½®ç­¾å
    signing {
        def signingKeyId = findProperty("signing.keyId")
        def signingPassword = findProperty("signing.password")
        def signingSecretKeyRingFile = findProperty("signing.secretKeyRingFile")
        
        if (signingKeyId && signingPassword && signingSecretKeyRingFile) {
            useInMemoryPgpKeys(signingKeyId, signingSecretKeyRingFile, signingPassword)
        }
    }
}

// å‘å¸ƒåˆ° Maven Central çš„ä»»åŠ¡
task publishToMavenCentral {
    dependsOn ':burial_plugin:publishMavenPublicationToOSSRHRepository'
    dependsOn ':burialTimer:publishReleasePublicationToOSSRHRepository'
    
    doLast {
        println "âœ… æ’ä»¶å’Œåº“å·²å‘å¸ƒåˆ° Maven Central"
        println "ğŸ“¦ burial-plugin: ${project(':burial_plugin').version}"
        println "ğŸ“¦ burial-timer: ${project(':burialTimer').version}"
        println ""
        println "ğŸ”— æ’ä»¶ä½¿ç”¨æ–¹å¼:"
        println "plugins {"
        println "    id 'com.yan.burial.burial-plugin' version '${project(':burial_plugin').version}'"
        println "}"
        println ""
        println "ğŸ“š åº“ä½¿ç”¨æ–¹å¼:"
        println "implementation 'com.yan.burial.method.timer:burial-timer:${project(':burialTimer').version}'"
    }
}

// å‘å¸ƒåˆ°æœ¬åœ° Maven ä»“åº“çš„ä»»åŠ¡
task publishToLocalMaven {
    dependsOn ':burial_plugin:publishMavenPublicationToMavenLocal'
    dependsOn ':burialTimer:publishReleasePublicationToMavenLocal'
    
    doLast {
        println "âœ… æ’ä»¶å’Œåº“å·²å‘å¸ƒåˆ°æœ¬åœ° Maven ä»“åº“"
        println "ğŸ“¦ burial-plugin: ${project(':burial_plugin').version}"
        println "ğŸ“¦ burial-timer: ${project(':burialTimer').version}"
    }
}
