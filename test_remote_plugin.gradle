// æµ‹è¯•è¿œç¨‹æ’ä»¶å’Œä¾èµ–çš„è„šæœ¬
// ä½¿ç”¨æ–¹æ³•: ./gradlew -b test_remote_plugin.gradle testRemotePlugin

buildscript {
    repositories {
        maven { url 'https://jitpack.io' }
        gradlePluginPortal()
        mavenCentral()
    }
    dependencies {
        // æµ‹è¯•è¿œç¨‹æ’ä»¶ä¾èµ–
        classpath 'com.github.zhiying94:burial-plugin:2.0.17'
    }
}

plugins {
    id 'java'
}

// åº”ç”¨è¿œç¨‹æ’ä»¶
apply plugin: 'com.github.zhiying94.burial-plugin'

repositories {
    maven { url 'https://jitpack.io' }
    mavenCentral()
}

dependencies {
    // æµ‹è¯•è¿œç¨‹åº“ä¾èµ–
    implementation 'com.github.zhiying94:burialTimer:2.0.17'
}

// é…ç½®æ’ä»¶
burialExt {
    enable = true
    logLevel = 'DEBUG'
    includePackages = ['com.burial.test']
    excludePackages = ['com.burial.test.ignorelist']
}

task testRemotePlugin {
    doLast {
        println "ğŸš€ æµ‹è¯•è¿œç¨‹æ’ä»¶å’Œä¾èµ–..."
        
        // æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£ç¡®åº”ç”¨
        if (project.plugins.hasPlugin('com.github.zhiying94.burial-plugin')) {
            println "âœ… è¿œç¨‹æ’ä»¶åº”ç”¨æˆåŠŸ: com.github.zhiying94.burial-plugin"
        } else {
            println "âŒ è¿œç¨‹æ’ä»¶åº”ç”¨å¤±è´¥"
        }
        
        // æ£€æŸ¥ä¾èµ–æ˜¯å¦è§£ææˆåŠŸ
        try {
            configurations.implementation.resolvedConfiguration.resolvedArtifacts.each { artifact ->
                if (artifact.name == 'burialTimer') {
                    println "âœ… è¿œç¨‹ä¾èµ–è§£ææˆåŠŸ: ${artifact.moduleVersion.id}"
                }
            }
        } catch (Exception e) {
            println "âŒ è¿œç¨‹ä¾èµ–è§£æå¤±è´¥: ${e.message}"
        }
        
        // æ£€æŸ¥æ’ä»¶é…ç½®
        if (project.hasProperty('burialExt')) {
            println "âœ… æ’ä»¶é…ç½®æˆåŠŸ"
            println "   - enable: ${burialExt.enable}"
            println "   - logLevel: ${burialExt.logLevel}"
            println "   - includePackages: ${burialExt.includePackages}"
            println "   - excludePackages: ${burialExt.excludePackages}"
        } else {
            println "âŒ æ’ä»¶é…ç½®å¤±è´¥"
        }
        
        println "ğŸ‰ è¿œç¨‹æ’ä»¶å’Œä¾èµ–æµ‹è¯•å®Œæˆï¼"
    }
}
